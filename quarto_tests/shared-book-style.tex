% Shared LaTeX styling for book projects
% Save as: shared-book-style.tex

% Document initialization (equivalent to your \AtBeginDocument block)
\usepackage{geometry}
\AtBeginDocument{
  \date{}
  \setcounter{tocdepth}{0}
  \setcounter{secnumdepth}{0}
  %\newgeometry{twoside,inner=0.9in,outer=0.5in,top=1in,bottom=1in}
  
  % The \headsep sets the distance between header line and body text
  \setlength{\headsep}{16pt}

  \clubpenalty=10000
  \widowpenalty=10000
  \displaywidowpenalty=10000

  \let\origtableofcontents\tableofcontents
  \renewcommand{\tableofcontents}{%
    \cleardoublepage
    \pagestyle{plain}
    \origtableofcontents
    \cleardoublepage
    \pagestyle{normal} 
  }
}

% Chapter formatting
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\hyphenpenalty=10000\exhyphenpenalty=10000}
  {}
  {0pt}
  {\Huge}
\titlespacing*{\chapter}{0pt}{0pt}{20pt}

% Code font size (Sphinx compatibility)
%\renewcommand{\sphinxcode}[1]{\texttt{\footnotesize #1}}
%\renewcommand{\sphinxupquote}[1]{#1}
\let\oldtexttt\texttt        % save original \texttt
\renewcommand{\texttt}[1]{{\footnotesize\oldtexttt{#1}}}

% Custom page styles with fancyhdr
\usepackage{fancyhdr}
\makeatletter
\fancypagestyle{normal}{
    \fancyhf{}
    \fancyhead[RE]{{\small\textit{\@title}}}
    \fancyhead[LO]{{\small\nouppercase{\textit{\leftmark}}}}
    \fancyhead[LE]{{\small\thepage}}
    \fancyhead[RO]{{\small\thepage}}
    \fancyfoot[LE,LO,RE,RO]{}
    \setlength{\footskip}{0pt}
    \addtolength{\textheight}{20pt}
    \renewcommand{\headrulewidth}{0.4pt}
}
\makeatother


\fancypagestyle{plain}{
    % first page of new chapter
    \fancyhf{}
    \fancyfoot[LE,LO,RE,RO]{}
    \setlength{\footskip}{0pt}
    \addtolength{\textheight}{20pt}
    \renewcommand{\headrulewidth}{0pt}
}

% New header
%\usepackage{titling}
\usepackage{hyperref}
\newfontfamily\headingfont[]{Gill Sans}


\makeatletter
\renewcommand{\maketitle}{%
  \thispagestyle{plain}
  \noindent\rule{\linewidth}{1pt}\par
  \begingroup
    \hypersetup{pdfauthor={\@author}, pdftitle={\@title}}%
  \endgroup
  \begin{flushright}
    \vspace{48pt}
    {\headingfont
    {\fontsize{44pt}{56pt}\selectfont \setlength{\baselineskip}{56pt}%
    \@title\par}
    \vspace{96pt}
    % HACK to handle quote
    %{\Large \@author}\par
    {\Large Tony {\textquotesingle}Monty{\textquotesingle} Hirst}\par
    
    \vspace{25pt}
    \@date \par

    }
  \end{flushright}

  \newpage
  \thispagestyle{plain}
  \thispagestyle{empty}

  \makeatletter

  \vspace*{\fill}

  \begin{center}
  %{\Large \textbf{\@title}}\\[1em]
  {\large \textbf{\textit{A Storynotes Collection}}}\\[2em]
  \end{center}

  \vfill

  \begin{center}
  \large \textit{montystoryteller.org}
  \end{center}

  \vspace{2cm}

  \begin{center}
  \textit{Copyright {\copyright} Anthony Hirst, 2025.\linebreak\linebreak This work may include transcripts of nineteenth century newspaper articles contemporary to the events described, sourced from the British Newspaper Archive, and transcribed by the author.\linebreak\linebreak This work may include transcripts of out of copyright works published prior to 1920 sourced from the Internet Archive.\linebreak\linebreak This work may include other openly licensed materials, acknowledged at the point of use.
  }
  \end{center}

  \vspace*{\fill}

  \begin{center}
    \textit{A Storynotes publication from montystoryteller.org}
  \end{center}
  \makeatother

  \setcounter{footnote}{0}
  \let\thanks\relax\let\maketitle\relax
}
\makeatother

\renewcommand{\chaptermark}[1]{%
  \markboth{#1}{}}

\usepackage{caption}
\captionsetup[figure]{labelformat=empty}

% Apply normal page style (equivalent to fancy in Quarto)
\pagestyle{normal}